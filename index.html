<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>0-10 單字聽打挑戰</title>
<style>
body { font-family: sans-serif; max-width: 600px; margin: auto; text-align: center; padding: 30px 15px; }
#logo, #logo-game { width: 150px; max-width: 80%; margin-bottom: 10px; display: block; margin-left: auto; margin-right: auto; }
#game-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
#mode-select button, button { display: block; width: 80%; max-width: 300px; margin: 10px auto; padding: 12px 20px; font-size: 16px; cursor: pointer; text-align: center; }
#check-btn, #next-btn, #submit-btn, #restart-btn, #mode-reselect-btn { width: 150px; }
.hidden { display: none; }
#answer, #nickname { padding: 8px; font-size: 16px; width: 80%; max-width: 300px; margin: 10px auto; display: block; text-align: center; }
audio { width: 100%; max-width: 500px; margin: 20px 0; display: block; margin-left:auto;margin-right:auto;}
#completion-note-practice, #completion-note-challenge { margin-top: 10px; font-size: 16px; color: #555; }
</style>
</head>
<body>

<script>
var password = prompt("請輸入密碼才能進入此網站：");
if (password !== "1231") { alert("密碼錯誤，無法進入！"); window.location.href = "https://www.google.com"; }
</script>

<div id="mode-select">
<img id="logo" src="logo.png" alt="Logo" />
<h2>請選擇模式</h2>
<button id="mode-practice-btn">練習模式（無時間限制）</button>
<button id="mode-challenge-btn">挑戰模式（限時）</button>
<p style="font-size:14px; color:#555; margin-top:10px;">兩種模式皆可重複練習～</p>
</div>

<div id="game-area" class="hidden">
<img id="logo-game" src="logo.png" alt="Logo"/>
<div id="game-title">0-10 單字聽打挑戰</div>
<div id="question-number"></div>
<div id="timer" style="font-size:18px; color:red; margin-bottom:15px;"></div>
<audio id="audio" controls></audio>
<input type="text" id="answer" placeholder="請輸入聽到的內容" autocomplete="off" />
<div id="result" style="min-height: 60px; margin-top: 10px;"></div>
<button id="check-btn" disabled>確認</button>
<button id="next-btn" style="display:none;">下一題</button>
</div>

<div id="nickname-section" class="hidden" style="margin-top:20px;">
<div id="completion-title" style="font-size:20px; margin-bottom:10px; color:#333;"></div>
<input type="text" id="nickname" placeholder="請輸入姓名＋生日( 範例：王小明0828 )" />
<div id="completion-note-practice" class="hidden" style="text-align:center; color:#555;"></div>
<div id="completion-note-challenge" class="hidden" style="text-align:center; color:#555;"></div>
<button id="submit-btn" disabled>提交成績</button>
<button id="restart-btn">重新開始</button>
<button id="mode-reselect-btn" style="margin-top:10px;">重新選擇模式</button>
</div>

<script>
const questions = [
{ audio: "001001W.mp3", answer: "밖", chinese: "外面" },
{ audio: "001002W.mp3", answer: "턱", chinese: "下巴" },
{ audio: "001003W.mp3", answer: "목", chinese: "脖子" },
{ audio: "001004W.mp3", answer: "약", chinese: "藥" },
{ audio: "001005W.mp3", answer: "학교", chinese: "學校" },
{ audio: "001006W.mp3", answer: "기차역", chinese: "火車站" },
{ audio: "001007W.mp3", answer: "약사", chinese: "藥師" },
{ audio: "001008W.mp3", answer: "가족", chinese: "家人" },
{ audio: "001009W.mp3", answer: "부엌", chinese: "廚房" },
{ audio: "001010W.mp3", answer: "목도리", chinese: "圍巾" },
{ audio: "001011W.mp3", answer: "반", chinese: "班級" },
{ audio: "001012W.mp3", answer: "손", chinese: "手" },
{ audio: "001013W.mp3", answer: "눈", chinese: "眼睛" },
{ audio: "001014W.mp3", answer: "돈", chinese: "錢" },
{ audio: "001015W.mp3", answer: "친구", chinese: "朋友" },
{ audio: "001016W.mp3", answer: "신문", chinese: "報紙" },
{ audio: "001017W.mp3", answer: "라면", chinese: "拉麵" },
{ audio: "001018W.mp3", answer: "언니", chinese: "姊姊" },
{ audio: "001019W.mp3", answer: "편지", chinese: "信" },
{ audio: "001020W.mp3", answer: "우산", chinese: "雨傘" },
{ audio: "001021W.mp3", answer: "밭", chinese: "旱田" },
{ audio: "001022W.mp3", answer: "낮", chinese: "白天" },
{ audio: "001023W.mp3", answer: "꽃", chinese: "花" },
{ audio: "001024W.mp3", answer: "옷", chinese: "衣服" },
{ audio: "001025W.mp3", answer: "버섯", chinese: "蘑菇" },
{ audio: "001026W.mp3", answer: "빚", chinese: "債務" },
{ audio: "001027W.mp3", answer: "도넛", chinese: "甜甜圈" },
{ audio: "001028W.mp3", answer: "맛", chinese: "味道" },
{ audio: "001029W.mp3", answer: "벚꽃", chinese: "櫻花" },
{ audio: "001030W.mp3", answer: "숫자", chinese: "數字" },
{ audio: "001031W.mp3", answer: "발", chinese: "腳" },
{ audio: "001032W.mp3", answer: "물", chinese: "水" },
{ audio: "001033W.mp3", answer: "굴", chinese: "生蠔" },
{ audio: "001034W.mp3", answer: "별", chinese: "星星" },
{ audio: "001035W.mp3", answer: "달", chinese: "月亮" },
{ audio: "001036W.mp3", answer: "아들", chinese: "兒子" },
{ audio: "001037W.mp3", answer: "딸기", chinese: "草莓" },
{ audio: "001038W.mp3", answer: "밤", chinese: "夜晚" },
{ audio: "001039W.mp3", answer: "꿈", chinese: "夢" },
{ audio: "001040W.mp3", answer: "곰", chinese: "熊" },
{ audio: "001041W.mp3", answer: "봄", chinese: "春天" },
{ audio: "001042W.mp3", answer: "김치", chinese: "泡菜" },
{ audio: "001043W.mp3", answer: "음식", chinese: "食物" },
{ audio: "001044W.mp3", answer: "엄마", chinese: "媽媽" },
{ audio: "001045W.mp3", answer: "사슴", chinese: "鹿" },
{ audio: "001046W.mp3", answer: "하품", chinese: "打哈欠" },
{ audio: "001047W.mp3", answer: "구름", chinese: "雲" },
{ audio: "001048W.mp3", answer: "밥", chinese: "飯" },
{ audio: "001049W.mp3", answer: "답", chinese: "答案" },
{ audio: "001050W.mp3", answer: "숲", chinese: "森林" },
{ audio: "001051W.mp3", answer: "잎", chinese: "葉子" },
{ audio: "001052W.mp3", answer: "지갑", chinese: "錢包" },
{ audio: "001053W.mp3", answer: "앞치마", chinese: "圍裙" },
{ audio: "001054W.mp3", answer: "무릎", chinese: "膝蓋" },
{ audio: "001055W.mp3", answer: "수업", chinese: "課程" },
{ audio: "001056W.mp3", answer: "접시", chinese: "盤子" },
{ audio: "001057W.mp3", answer: "옆집", chinese: "住隔壁的" },
{ audio: "001058W.mp3", answer: "방", chinese: "房間" },
{ audio: "001059W.mp3", answer: "빵", chinese: "麵包" },
{ audio: "001060W.mp3", answer: "강", chinese: "河流" },
{ audio: "001061W.mp3", answer: "병", chinese: "瓶子" },
{ audio: "001062W.mp3", answer: "영어", chinese: "英語" },
{ audio: "001063W.mp3", answer: "가방", chinese: "包包" },
{ audio: "001064W.mp3", answer: "식당", chinese: "餐廳" },
{ audio: "001065W.mp3", answer: "짜장면", chinese: "雜醬麵" },
{ audio: "001066W.mp3", answer: "봉투", chinese: "信封" },
{ audio: "001067W.mp3", answer: "상어", chinese: "鯊魚" }
];

const modeSelectDiv = document.getElementById("mode-select");
const modePracticeBtn = document.getElementById("mode-practice-btn");
const modeChallengeBtn = document.getElementById("mode-challenge-btn");
const gameAreaDiv = document.getElementById("game-area");
const gameTitle = document.getElementById("game-title");
const questionNumberDiv = document.getElementById("question-number");
const timerDiv = document.getElementById("timer");
const audioEl = document.getElementById("audio");
const answerInput = document.getElementById("answer");
const checkBtn = document.getElementById("check-btn");
const nextBtn = document.getElementById("next-btn");
const resultDiv = document.getElementById("result");
const nicknameSection = document.getElementById("nickname-section");
const completionTitle = document.getElementById("completion-title");
const nicknameInput = document.getElementById("nickname");
const submitBtn = document.getElementById("submit-btn");
const restartBtn = document.getElementById("restart-btn");
const modeReselectBtn = document.getElementById("mode-reselect-btn");
const completionNotePractice = document.getElementById("completion-note-practice");
const completionNoteChallenge = document.getElementById("completion-note-challenge");

let shuffledQuestions = [];
let current = 0;
let correct = 0;
let finalScore = 0;
let timer = null;
let timeLeft = 0;
let timerStarted = false;
let currentMode = null;
let startTime = null; // 記錄挑戰開始時間

function shuffle(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}return array;}

// 抽 n 題
function getRandomQuestions(count) {
  return shuffle([...questions]).slice(0, count);
}

function showModeSelect(){
  modeSelectDiv.style.display="block";
  gameAreaDiv.classList.add("hidden");
  nicknameSection.classList.add("hidden");
  resetGameVars();
}

function showGameArea(){
  modeSelectDiv.style.display="none";
  gameAreaDiv.classList.remove("hidden");
  nicknameSection.classList.add("hidden");
  timerDiv.style.display=currentMode==="challenge"?"block":"none";
  submitBtn.disabled=true;
  if(currentMode==="challenge"){
    timeLeft=shuffledQuestions.length*10;
    timerDiv.textContent=`剩餘時間：${timeLeft} 秒`;
  } else {
    timerDiv.textContent="";
  }
  startTime = Date.now();
}

function resetGameVars(){
  clearInterval(timer); timer=null; timerStarted=false; timeLeft=0;
  current=0; correct=0; finalScore=0;
  submitBtn.disabled=true; answerInput.value=""; answerInput.disabled=false;
  checkBtn.disabled=true; nextBtn.style.display="none"; resultDiv.innerHTML="";
  questionNumberDiv.textContent=""; timerDiv.textContent="";
}

function loadQuestion(){
  if(shuffledQuestions.length===0){shuffledQuestions=getRandomQuestions(25);}
  if(current>=shuffledQuestions.length){endGame();return;}
  const q=shuffledQuestions[current];
  audioEl.src=q.audio;
  questionNumberDiv.textContent=`第 ${current+1} 題 / 共 ${shuffledQuestions.length} 題`;
  audioEl.style.display="block"; answerInput.style.display="block"; checkBtn.style.display="block"; nextBtn.style.display="none"; questionNumberDiv.style.display="block"; resultDiv.style.display="block";
  answerInput.value=""; answerInput.disabled=false; checkBtn.disabled=true; resultDiv.innerHTML="";
}

function startTimer(){
  if(timerStarted||currentMode==="practice")return;
  timerStarted=true; if(timeLeft<=0)timeLeft=shuffledQuestions.length*10;
  timer=setInterval(()=>{
    timeLeft--;
    timerDiv.textContent=`剩餘時間：${timeLeft} 秒`;
    if(timeLeft<=0){clearInterval(timer); endGame();}
  },1000);
}

modePracticeBtn.addEventListener("click",()=>{currentMode="practice"; shuffledQuestions=getRandomQuestions(25); resetGameVars(); showGameArea(); loadQuestion();});
modeChallengeBtn.addEventListener("click",()=>{currentMode="challenge"; shuffledQuestions=getRandomQuestions(25); resetGameVars(); showGameArea(); loadQuestion();});

answerInput.addEventListener("input",()=>{checkBtn.disabled=answerInput.value.trim()==="";});
audioEl.addEventListener("play",()=>{if(currentMode==="challenge"&&!timerStarted) startTimer();});
answerInput.addEventListener("focus",()=>{if(currentMode==="challenge"&&!timerStarted) startTimer();});

checkBtn.addEventListener("click",()=>{
  const userAns=answerInput.value.trim();
  const q=shuffledQuestions[current];
  const correctAns=q.answer.trim();
  if(userAns===correctAns){resultDiv.innerHTML=`✅ 答對了🎉 你真棒👍🏻<br>📘 中文：<strong>${q.chinese}</strong>`; correct++;}
  else{resultDiv.innerHTML=`❌ 錯誤。正確答案是：<strong>${correctAns}</strong><br>📘 中文：<strong>${q.chinese}</strong>`;}
  answerInput.disabled=true; checkBtn.disabled=true; nextBtn.style.display="block"; resultDiv.style.display="block";
});

nextBtn.addEventListener("click",()=>{current++; if(current<shuffledQuestions.length){loadQuestion();} else {endGame();}});

function endGame(){
  clearInterval(timer); timerStarted=false;
  finalScore=Math.round((correct/shuffledQuestions.length)*100);
  const passStatus=finalScore>=80?"✅ 合格 可重新挑戰":"❌ 不合格 請重新挑戰";
  completionTitle.textContent=`你答對 ${correct}/${shuffledQuestions.length} 題，得分 ${finalScore}% - ${passStatus}`;
  nicknameSection.classList.remove("hidden");
  if(currentMode==="practice"){
    completionNotePractice.textContent="可重複練習\n最後記得到挑戰模式回傳合格成績歐！！";
    completionNotePractice.style.whiteSpace="pre-line"; completionNotePractice.classList.remove("hidden");
    completionNoteChallenge.classList.add("hidden"); nicknameInput.style.display="none"; submitBtn.style.display="none";
  } else {
    completionNotePractice.classList.add("hidden");
    completionNoteChallenge.textContent="請回傳合格成績歐！！"; completionNoteChallenge.classList.remove("hidden");
    nicknameInput.style.display="block"; submitBtn.style.display="inline-block"; submitBtn.disabled=finalScore<80;
  }
  audioEl.style.display="none"; answerInput.style.display="none"; checkBtn.style.display="none"; nextBtn.style.display="none";
  questionNumberDiv.style.display="none"; timerDiv.style.display="none"; resultDiv.style.display="none";
}

submitBtn.addEventListener("click",()=>{
  const nickname=nicknameInput.value.trim();
  if(!nickname||finalScore<80)return;
  const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
  const weekdayNames=["日","一","二","三","四","五","六"];
  const weekday=weekdayNames[new Date().getDay()];
  const gameTitleText=gameTitle.textContent;
  const formURL="https://docs.google.com/forms/d/e/1FAIpQLSd8KhDu_lq6g4aPzkLaNYUUVG9P0E9cRT1R2WVDIkkfFh7WxA/formResponse";
  const formData=new FormData();
  formData.append("entry.1082970818",nickname);
  formData.append("entry.851626887",finalScore);
  formData.append("entry.498226528",elapsedSeconds + " 秒");
  formData.append("entry.532888754",weekday);
  formData.append("entry.1110600272",gameTitleText);
  fetch(formURL,{method:"POST",body:formData,mode:"no-cors"})
    .then(()=>alert("成績已送出，謝謝！"))
    .catch(()=>alert("無法送出成績，請稍後再試。"));
});

restartBtn.addEventListener("click",()=>{resetGameVars(); shuffledQuestions=getRandomQuestions(25); showGameArea(); loadQuestion();});
modeReselectBtn.addEventListener("click",()=>{currentMode=null; resetGameVars(); showModeSelect();});

showModeSelect();
</script>
</body>
</html>
